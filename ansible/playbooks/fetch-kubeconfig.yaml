---
# tasks file for fetch-kubeconfig

- name: Copy kubeconfig generated by kubespray into ~/.kube
  hosts: localhost
  connection: local
  tasks:
    - name: Set inventory location
      set_fact:
        cluster_inventory_directory:
          "{{ ansible_facts.env.HOME + '/generated/kubespray-inventory' }}"

    - name: Make ~/.kube
      file:
        path: "{{ ansible_facts.env.HOME }}/.kube"
        state: directory
        owner: "{{ ansible_facts.env.USER }}"
        mode: '0700'

    - name: Copy admin.conf
      copy:
        src: "{{ cluster_inventory_directory }}/artifacts/admin.conf"
        remote_src: true
        dest: "{{ ansible_facts.env.HOME }}/.kube/config"
        owner: "{{ ansible_facts.env.USER }}"
        mode: '0600'
